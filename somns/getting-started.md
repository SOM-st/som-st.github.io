---
title:  Getting Started Guide for SOMns Development
layout: default
---

<style>
  p, h2, h3, h4, h5, h6 { margin-bottom: 1ex }
  h2, h3, h4, h5, h6 { margin-top: 2ex }
  div.highlighter-rouge { margin-top: 1ex; margin-bottom: 1ex; margin-left: 2em; }
  h1 { font-size: 300% }
  h2 { font-size: 250% }
  h3 { font-size: 200% }
  h4 { font-size: 150%; font-weight: bold; }
</style>

# Getting Started with SOMns Development

<div class="content-section odd"><div class="wrap" markdown="1">

This guide gives an overview of the development infrastructure and setup
used for working on SOMns. First, the basics of obtaining the code, setting up
software dependencies, the development environment, and how to contribute code
are discussed. Afterwards, we briefly give an overview of the repository and
code layout. And finally, look at the additional infrastructure used by the
project.

</div></div>

<div class="content-section even"><div class="wrap" markdown="1">

## 1. Setup

### 1.1 Minimal Software Requirements

SOMns is implemented in Java 8, uses Ant as a build system, git as
source control system, and Python for a launcher script.

On Ubuntu, the following instructions will install the necessary dependencies:  

```bash
sudo add-apt-repository ppa:webupd8team/java
sudo apt install oracle-java8-installer git ant
```

### 1.2 Getting the Code and Running Hello World

To checkout the code:

```bash
git clone https://github.com/smarr/SOMns.git
```

Then, SOMns can be build with Ant:

```bash
cd SOMns
ant compile  ## will also download dependencies
```

Afterwards, the simple Hello World program is executed with:

```bash
./som -G core-lib/Hello.som
```

### 1.3 Development Environment

To setup a complete development environment, we need also the Graal just-in-time
compiler, and Node.js to work on the Kompos Web Debugger.

On Ubuntu, the necessary software can be installed with:

```bash
## First, installing Node.js and the Node Package Manager (NPM)
curl -sL https://deb.nodesource.com/setup_7.x | sudo -E bash -
sudo apt install npm nodejs

## Second, installing and compiling the Graal JIT Compiler
cd .. ## leaving the SOMns folder
git clone --recursive https://github.com/smarr/GraalBasic.git
cd GraalBasic
yes "n" | ./build.sh
cd ../SOMns
ant ## to ensure everything is compiled
```

At this point, it should be possible to use Graal to run SOMns by dropping the
`-G` option from the command line:

```bash
./som core-lib/Hello.som
```

<figure style="float: right; margin-right: -100px">
<img style="width: 200px;" src="../eclipse-project-outline.png" alt="Eclipse Project outline" />
<figcaption>
Eclipse Project outline.
</figcaption>
</figure>

#### 1.3.1 Eclipse to Develop the Interpreter


SOMns is currently developed with Eclipse. While other Java IDEs can also be
used, for brevity, we'll focus on Eclipse only.

At the time of writing, I am using [Eclipse Neon 4.6](https://eclipse.org/downloads/).
Please also install the **Eclipse Checkstyle Plugin** from the [Eclipse Marketplace](http://eclipse-cs.sourceforge.net/#!/install).

For development, we also need to setup all Eclipse projects:

```bash
ant ideinit
```

After the Eclipse projects for the Truffle library were generated by this step,
we can import the *existing* projects into Eclipse with *File* -> *Import...* ->
*Existing Projects into Workspace* and pointing Eclipse to the SOMns folder.

I like to import the Truffle projects into a separate Truffle working set. This
makes working in Eclipse with many projects easier. 

The result should be looking roughtly, but not exactly like in the screenshot on
the right.

For debugging the interpreter with Eclipse, create a Eclipse run configuration
for the SOMns project. The main class is `som.VM`. To run for instance  the
Mandelbrot benchmark, add the following as program arguments:

    core-lib/Benchmarks/Harness.som Mandelbrot 2 0 500

In VM arguments, enable assertions with:

    -ea -esa

I personally start the various SOMns programs from the command line:

```bash
./som -d -G core-lib/Benchmarks/Harness.som Mandelbrot 2 0 500
```

For this approach, we need a *Remote Java Application* debug configuration
in Eclipse. After starting SOMns, it should tell you that it is waiting on port
`8000`, which is used as the port in the Eclipse debug configuration.

#### 1.3.2 VS Code to Develop with the SOMns Language

To have IDE-like support for working with SOMns code, we are using
[VS Code](https://code.visualstudio.com/), a cross-platform editor for which we
have SOMns integration.

SOMns support can be installed via the
[VS Code marketplace](https://marketplace.visualstudio.com/items?itemName=MetaConcProject.SOMns).

### 1.4 Summary

A brief list of steps:

1. Install software dependencies: ant, git, Java 8, Eclipse 4.6 (or later),
   VS Code 1.8 (or later), Node.js, NPM, Graal JIT compiler

2. Create Truffle Eclipse projects: `ant ideinit`

3. Import Eclipse projects

4. Run `ant` from the command line or Eclipse

</div></div>


<div class="content-section odd"><div class="wrap" markdown="1">

### Infrastructure

foo

#### Build System

- ant
- SOMns-deps

#### Continuous Development Infrastructure


#### Development Support

- checkstyle
- github
- codacy
- coveralls

</div></div>

<div class="content-section odd">
<div class="wrap" markdown="1">

### Code Layout

</div></div>

<div class="content-section odd">
<div class="wrap" markdown="1">

### Setup

</div></div>

